<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成員介紹 - 國際遊戲協會</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
    <!-- Header -->
    <header class="bg-light py-3">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-5 d-flex justify-content-center">
                    <img src="img/logogif.gif" alt="Logo" class="img-fluid" style="max-width: 80px;">
                </div>
                <div class="col-md-7">
                    <nav class="d-flex justify-content-center">
                        <ul class="nav">
                            <li class="nav-item"><a class="nav-link" href="index.html">首頁</a></li>
                            <li class="nav-item"><a class="nav-link" href="about.html">關於我們</a></li>
                            <li class="nav-item"><a class="nav-link" href="member.html">成員介紹</a></li>
                            <li class="nav-item"><a class="nav-link" href="news.html">最新消息</a></li>
                            <li class="nav-item"><a class="nav-link" href="course.html">課程介紹</a></li>
                            <li class="nav-item"><a class="nav-link" href="contact.html">聯絡我們</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center text-warning mb-4">成員介紹</h2>
            <div id="members" class="row">
                <!-- 動態插入成員資料 -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-lg-5 mb-3">
                    <div class="text-center">
                        <img src="img/logo-150x150.jpeg" alt="Logo" class="img-fluid mb-2" style="max-width: 100px;">
                    </div>
                    <p>遊戲 是最高形式的研究；樂育 是最高層次的學習。<br>
                        Play, is research in its highest form.<br>
                        Edutainment, is learning on its highest level.</p>
                </div>
                <div class="col-lg-3 mb-2">
                    <ul class="list-unstyled">
                        <li><i class="fa fa-map-marker"></i> 地址：220新北市板橋區中正路435號</li>
                        435藝文特區台灣玩具博物館
                        <li><i class="fa fa-fax"></i> 傳真：(02)8972-7185</li>
                        <li><i class="fa fa-envelope"></i> E-mail：<a href="mailto:ipat1071001@ipat.org.tw"
                                class="text-white">ipat1071001@ipat.org.tw</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 text-center mb-3">
                    <ul class="list-inline">
                        <li class="list-inline-item"><a
                                href="https://www.facebook.com/IPAT-International-Play-Association-Taiwan-Branch-106772071551600"
                                target="_blank" rel="noopener noreferrer"><img src="img/facebook.png" alt="Facebook"
                                    class="img-fluid" style="max-width: 30px;"></a></li>
                        <li class="list-inline-item"><a
                                href="https://line.me/ti/g2/ftLDwke6OMbboIQNbkGf4Q?utm_source=invitation&amp;utm_medium=link_copy&amp;utm_campaign=default"
                                target="_blank" rel="noopener noreferrer"><img src="img/line.png" alt="Line"
                                    class="img-fluid" style="max-width: 30px;"></a></li>
                        <li class="list-inline-item"><a href="https://twitter.com/ipataiwan1" target="_blank"
                                rel="noopener noreferrer"><img src="img/twitter.png" alt="Twitter" class="img-fluid"
                                    style="max-width: 30px;"></a></li>
                        <li class="list-inline-item"><a href="https://www.instagram.com/ipataiwan/" target="_blank"
                                rel="noopener noreferrer"><img src="img/IG.png" alt="Instagram" class="img-fluid"
                                    style="max-width: 30px;"></a></li>
                        <li class="list-inline-item">
                            <a href="Backstage.html" target="_blank" rel="noopener noreferrer">
                                <img src="img/transparent.png" alt="Backstage" class="img-fluid"
                                    style="max-width: 30px; opacity: 0;">
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="text-center mt-3">
                <p>© Copyright 2025. 網頁設計 By Zero.Lin</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-auth-compat.js"></script>
    <script src="js/firebase-data.js"></script>
    <script src="js/member.js"></script>

    <script>
        // 頁面加載時獲取成員資料
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                console.log("member.html 開始載入資料");

                // 確認 dataManager 是否正確初始化
                if (!window.dataManager) {
                    console.error("dataManager 未初始化");
                    alert("資料管理器初始化失敗，請重新載入頁面");
                    return;
                }

                const membersData = await window.dataManager.getMembers();
                console.log(membersData);
                renderMembers(membersData);
            } catch (error) {
                console.error('載入成員資料時出錯:', error);
            }
        });

        // 渲染成員卡片
        function renderMembers(members) {
            const membersContainer = document.getElementById('members');
            membersContainer.innerHTML = '';

            if (!members || members.length === 0) {
                membersContainer.innerHTML = '<div class="col-12 text-center"><p>目前沒有可用的成員資訊</p></div>';
                return;
            }

            // 按職稱排序 - 先排領導職位
            const positionOrder = {
                '理事長': 1,
                '秘書長': 2,
                '顧問': 3,
                '常務監事': 4,
                '常務理事': 5,
                '理事': 6,
                '監事': 7,
                '會員': 8
            };

            const sortedMembers = [...members].sort((a, b) => {
                // 如果是數組形式的標籤，取第一個標籤作為主要職稱
                const tagA = Array.isArray(a.tag) ? a.tag[0] : a.tag;
                const tagB = Array.isArray(b.tag) ? b.tag[0] : b.tag;

                const orderA = positionOrder[tagA] || 99;
                const orderB = positionOrder[tagB] || 99;

                return orderA - orderB;
            });

            sortedMembers.forEach(member => {
                // 檢查成員是否有職稱標籤
                let title = '會員';
                if (member.tag) {
                    if (Array.isArray(member.tag)) {
                        title = member.tag.join('、');
                    } else {
                        title = member.tag;
                    }
                }

                const memberDiv = document.createElement('div');
                memberDiv.className = 'col-md-12 mb-4';
                memberDiv.innerHTML = `
                    <div class="card">
                        <div class="row g-0">
                            <div class="col-md-1">
                                </div>
                            <div class="col-md-3">
                               <!-- <img src="img/member/${member.id}.jpg" class="img-fluid rounded-start" alt="${member.name || '無姓名'}"> -->
                               <img src="https://firebasestorage.googleapis.com/v0/b/ipat-database.firebasestorage.app/o/member%2F${member.id}.webp?alt=media" class="img-fluid rounded-start" alt="${member.name || '無姓名'}">
                            </div>
                            <div class="col-md-7">
                                <div class="card-body">
                                    <h5 class="card-title">${member.name || '無姓名'} - ${title}</h5>
                                    <p class="card-text">${member.introduction || '無簡介'}</p>
                                    ${renderUrlLinks(member.urls)}
                                </div>
                            </div>
                            <div class="col-md-1">
                                </div>
                        </div>
                    </div>
                `;
                
                membersContainer.appendChild(memberDiv);
            });
        }
    
    // 處理URLs數組，將其轉換為HTML連結
    function renderUrlLinks(urls) {
            if (!urls || !Array.isArray(urls) || urls.length === 0) {
                return '';
            }
            
            let linksHtml = '<div class="col-md-12 mb-3"><div class="d-flex flex-wrap gap-2">';
            
            urls.forEach(urlItem => {
                const parts = urlItem.split('|||');
                if (parts.length === 2) {
                    const [text, link] = parts;
                    linksHtml += `<a href="${link}" class="btn btn-sm btn-outline-primary col-2" target="_blank">${text}</a>`;

                }
            });
            
            linksHtml += '</div></div>';
            return linksHtml;
        }
    </script>
</body>

</html>